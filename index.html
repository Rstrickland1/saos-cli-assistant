<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ciena SAOS Provisioning Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .input-field, .checkbox-label input {
            @apply w-full px-3 py-2 border rounded-md placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all duration-200;
        }
        input[type="text"].input-field, input[type="number"].input-field {
            background-color: #374151; border-color: #4B5563; color: white;
        }
        select.input-field {
            background-color: #F9FAFB; border-color: #9CA3AF; color: black;
        }
        .label { @apply block text-sm font-medium text-gray-300 mb-1; }
        .btn { @apply px-4 py-2 rounded-md font-semibold text-white transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed; }
        .btn-primary { @apply bg-cyan-600 hover:bg-cyan-700; }
        .btn-secondary { @apply bg-gray-600 hover:bg-gray-700; }
        .btn-copy { @apply bg-teal-600 hover:bg-teal-700; }
        .copied { @apply bg-green-600 hover:bg-green-700; }
        .warning-box { @apply bg-yellow-900 border-l-4 border-yellow-500 text-yellow-200 p-4 rounded-r-lg mt-4; }
        .checkbox-label { @apply flex items-center space-x-2 text-gray-300; }
        .checkbox-label input { @apply w-4 h-4 text-cyan-600 bg-gray-700 border-gray-600 rounded focus:ring-cyan-500; }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-cyan-400">Ciena SAOS Provisioning Assistant</h1>
            <p class="text-gray-400 mt-2">Select a provisioning workflow, fill in the parameters, and generate a complete CLI script.</p>
        </header>

        <main class="bg-gray-800 p-6 rounded-lg shadow-2xl border border-gray-700">
            <div class="mb-6">
                <label for="workflow-select" class="label">Provisioning Workflow</label>
                <select id="workflow-select" class="input-field">
                    <option value="">-- Select a Workflow --</option>
                </select>
            </div>

            <div id="params-form" class="space-y-4 mb-6"></div>
            
            <div id="warnings-container" class="space-y-2 mb-6"></div>

            <div class="flex items-center justify-start space-x-4 mb-6">
                <button id="generate-btn" class="btn btn-primary" disabled>Generate Script</button>
                <button id="clear-btn" class="btn btn-secondary">Clear</button>
            </div>

            <div>
                <label class="label">Generated Provisioning Script</label>
                <div class="bg-gray-900 p-4 rounded-md border border-gray-600 relative">
                    <pre><code id="output-command" class="text-cyan-300 whitespace-pre-wrap break-all"></code></pre>
                    <button id="copy-btn" class="btn btn-copy absolute top-2 right-2 text-xs py-1 px-2" style="display: none;">Copy</button>
                </div>
            </div>
        </main>
        
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>Developed to simplify SAOS service provisioning.</p>
        </footer>
    </div>

    <script>
        const workflowDb = {
            "l2_p2p_eline": {
                name: "L2 Point-to-Point Service (E-Line)",
                params: [
                    { name: "service_name", label: "Service Name", type: "text", placeholder: "e.g., CustomerA_X-Connect" },
                    { name: "port_a", label: "Port A", type: "text", placeholder: "e.g., 1/1" },
                    { name: "port_b", label: "Port B", type: "text", placeholder: "e.g., 1/2" },
                    { name: "vlan_id", label: "VLAN ID", type: "number", placeholder: "e.g., 100" },
                    { name: "add_l2_transform", label: "Add L2 Transform (VLAN Swap)", type: "checkbox" },
                    { name: "vlan_b", label: "VLAN ID for Port B (if transform)", type: "number", placeholder: "e.g., 200", condition: "add_l2_transform" }
                ],
                notes: ["This workflow creates a basic VLAN-based point-to-point cross-connect (E-Line) between two ports."],
                generate: (p) => {
                    const vs_name = `vs_${p.service_name}`;
                    const sp_a_name = `sp_${p.port_a.replace('/', '_')}_${p.vlan_id}`;
                    const sp_b_name = `sp_${p.port_b.replace('/', '_')}_${p.add_l2_transform ? p.vlan_b : p.vlan_id}`;
                    const vlan_b = p.add_l2_transform ? p.vlan_b : p.vlan_id;

                    let script = `!
! ### Workflow: L2 Point-to-Point Service (E-Line) ###
! Service: ${p.service_name}
! Port A: ${p.port_a} (VLAN ${p.vlan_id}) <--> Port B: ${p.port_b} (VLAN ${vlan_b})
!

# Step 1: Create a dedicated virtual switch for the service.
virtual-switch create vs ${vs_name}

`;

                    script += `# Step 2: Create and configure the sub-port for Port A.
sub-port create sub-port ${sp_a_name} parent-port ${p.port_a} classifier-precedence 10
sub-port add sub-port ${sp_a_name} class-element 1 vtag-stack ${p.vlan_id}
`;

                    if (p.add_l2_transform) {
                        script += `sub-port set sub-port ${sp_a_name} egress-l2-transform pop-1;stamp-8100.${vlan_b}.map\n`;
                    }

                    script += `
# Step 3: Create and configure the sub-port for Port B.
sub-port create sub-port ${sp_b_name} parent-port ${p.port_b} classifier-precedence 10
sub-port add sub-port ${sp_b_name} class-element 1 vtag-stack ${vlan_b}
`;
                    if (p.add_l2_transform) {
                        script += `sub-port set sub-port ${sp_b_name} egress-l2-transform pop-1;stamp-8100.${p.vlan_id}.map\n`;
                    }
                    
                    script += `
# Step 4: Attach both sub-ports to the virtual switch to complete the cross-connect.
virtual-switch interface attach sub-port ${sp_a_name} vs ${vs_name}
virtual-switch interface attach sub-port ${sp_b_name} vs ${vs_name}

! ### End of Workflow ###`;
                    
                    return script;
                }
            },
            "l3_interface_setup": {
                name: "L3 Routed Interface Setup",
                params: [
                    { name: "port", label: "Physical Port", type: "text", placeholder: "e.g., 3/1" },
                    { name: "vlan_id", label: "Interface VLAN ID", type: "number", placeholder: "e.g., 200" },
                    { name: "if_name", label: "IP Interface Name", type: "text", placeholder: "e.g., ipif_to_core" },
                    { name: "ip_address", label: "IP Address", type: "text", placeholder: "e.g., 10.10.20.1" },
                    { name: "prefix", label: "Prefix Length", type: "number", placeholder: "e.g., 24" }
                ],
                notes: ["This workflow provisions all components needed for a single Layer 3 routed interface."],
                generate: (p) => {
                    const vs_name = `vs_${p.if_name}`;
                    const sp_name = `sp_${p.port.replace('/', '_')}_${p.vlan_id}`;
                    const cpu_if_name = `cpu_${p.if_name}`;

                    return `!
! ### Workflow: L3 Routed Interface Setup ###
! Port: ${p.port}
! VLAN: ${p.vlan_id}
! IP Address: ${p.ip_address}/${p.prefix}
!

# Step 1: Create a virtual switch to host the L3 interface.
virtual-switch create vs ${vs_name}

# Step 2: Create the sub-port that will carry the L3 traffic.
sub-port create sub-port ${sp_name} parent-port ${p.port} classifier-precedence 10
sub-port add sub-port ${sp_name} class-element 1 vtag-stack ${p.vlan_id}

# Step 3: Create the CPU sub-interface for packet processing.
cpu-interface sub-interface create cpu-subinterface ${cpu_if_name} cpu-egress-l2-transform pop-1;stamp-8100.${p.vlan_id}.map

# Step 4: Attach the physical and CPU interfaces to the virtual switch.
virtual-switch interface attach sub-port ${sp_name} vs ${vs_name}
virtual-switch interface attach cpu-subinterface ${cpu_if_name} vs ${vs_name}

# Step 5: Create the logical IP interface on the virtual switch.
interface create ip-interface ${p.if_name} ip ${p.ip_address}/${p.prefix} vs ${vs_name}

! ### End of Workflow ###`;
                }
            },
            "mpls_l2vpn_p2p": {
                name: "MPLS L2VPN P2P Service (VPWS)",
                 params: [
                    { name: "service_name", label: "Service Name", type: "text", placeholder: "e.g., CustA_VPWS" },
                    { name: "port", label: "Local Customer Port", type: "text", placeholder: "e.g., 4/1" },
                    { name: "vlan_id", label: "Local Customer VLAN ID", type: "number", placeholder: "e.g., 300" },
                    { name: "pw_id", label: "Pseudowire ID", type: "number", placeholder: "e.g., 3001 (must match peer)" },
                    { name: "peer_ip", label: "Remote PE Router IP", type: "text", placeholder: "e.g., 10.1.1.2" },
                    { name: "tunnel_name", label: "Underlying TE Tunnel Name", type: "text", placeholder: "e.g., Tunnel_to_PE2" }
                ],
                notes: ["This workflow creates a point-to-point L2VPN service (VPWS) over an existing MPLS TE tunnel.", "Ensure the underlying TE tunnel to the peer is already provisioned and operational.", "The Pseudowire ID must be identical on both PE routers for the service to come up."],
                generate: (p) => {
                     const vs_name = `vs_${p.service_name}`;
                     const sp_name = `sp_${p.port.replace('/', '_')}_${p.vlan_id}`;
                     const vc_name = `dvc_${p.service_name}`;
                    return `!
! ### Workflow: MPLS L2VPN P2P Service (VPWS) ###
! Service: ${p.service_name}
! Local Port: ${p.port} (VLAN ${p.vlan_id})
! Peer: ${p.peer_ip} (PW ID: ${p.pw_id})
!

# Step 1: Create a virtual switch for the service.
virtual-switch create vs ${vs_name}

# Step 2: Create and configure the customer-facing sub-port.
sub-port create sub-port ${sp_name} parent-port ${p.port} classifier-precedence 10
sub-port add sub-port ${sp_name} class-element 1 vtag-stack ${p.vlan_id}

# Step 3: Create the dynamic virtual circuit (pseudowire).
mpls l2-vpn create dynamic-vc ${vc_name} pw-id ${p.pw_id} peer ${p.peer_ip} te-tunnel ${p.tunnel_name}

# Step 4: Attach the customer sub-port and the MPLS VC to the virtual switch.
virtual-switch interface attach sub-port ${sp_name} vs ${vs_name}
virtual-switch interface attach mpls-vc ${vc_name} vs ${vs_name}

! ### End of Workflow ###`;
                }
            }
        };

        const workflowSelect = document.getElementById('workflow-select');
        const paramsForm = document.getElementById('params-form');
        const warningsContainer = document.getElementById('warnings-container');
        const generateBtn = document.getElementById('generate-btn');
        const clearBtn = document.getElementById('clear-btn');
        const outputCommand = document.getElementById('output-command');
        const copyBtn = document.getElementById('copy-btn');
        
        function populateWorkflows() {
            Object.keys(workflowDb).forEach(key => {
                const workflow = workflowDb[key];
                const option = document.createElement('option');
                option.value = key;
                option.textContent = workflow.name;
                workflowSelect.appendChild(option);
            });
        }

        function displayWarnings(workflow) {
            warningsContainer.innerHTML = '';
            if (workflow && workflow.notes) {
                const warningDiv = document.createElement('div');
                warningDiv.className = 'warning-box';
                let notesHtml = '<strong>Notes & Warnings:</strong><ul>';
                workflow.notes.forEach(note => {
                    notesHtml += `<li class="list-disc ml-5">${note}</li>`;
                });
                notesHtml += '</ul>';
                warningDiv.innerHTML = notesHtml;
                warningsContainer.appendChild(warningDiv);
            }
        }
        
        function toggleConditionalFields() {
            const selectedWorkflowKey = workflowSelect.value;
            if (!selectedWorkflowKey) return;
            const workflow = workflowDb[selectedWorkflowKey];

            workflow.params.forEach(param => {
                if (param.condition) {
                    const conditionCheckbox = document.getElementById(`param-${param.condition}`);
                    const targetField = document.getElementById(`param-${param.name}`).parentElement;
                    if (conditionCheckbox && targetField) {
                        targetField.style.display = conditionCheckbox.checked ? 'block' : 'none';
                    }
                }
            });
        }

        populateWorkflows();

        workflowSelect.addEventListener('change', () => {
            const selectedWorkflowKey = workflowSelect.value;
            paramsForm.innerHTML = '';
            warningsContainer.innerHTML = '';
            outputCommand.textContent = '';
            copyBtn.style.display = 'none';

            if (!selectedWorkflowKey) {
                generateBtn.disabled = true;
                return;
            }

            generateBtn.disabled = false;
            const workflow = workflowDb[selectedWorkflowKey];
            displayWarnings(workflow);

            workflow.params.forEach(param => {
                let inputHtml = '';
                const paramDiv = document.createElement('div');

                if (param.type === 'checkbox') {
                    inputHtml = `<label class="checkbox-label"><input type="checkbox" id="param-${param.name}"><span>${param.label}</span></label>`;
                    paramDiv.innerHTML = inputHtml;
                } else {
                    if (param.type === 'select') {
                        const optionsHtml = param.options.map(opt => `<option value="${opt}">${opt}</option>`).join('');
                        inputHtml = `<select id="param-${param.name}" class="input-field">${optionsHtml}</select>`;
                    } else {
                        inputHtml = `<input type="${param.type}" id="param-${param.name}" class="input-field" placeholder="${param.placeholder || ''}">`;
                    }
                    paramDiv.innerHTML = `<label for="param-${param.name}" class="label">${param.label}</label>${inputHtml}`;
                }
                paramsForm.appendChild(paramDiv);
            });
            
            toggleConditionalFields(); // Initial check
            paramsForm.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                 checkbox.addEventListener('change', toggleConditionalFields);
            });
        });

        generateBtn.addEventListener('click', () => {
            const selectedWorkflowKey = workflowSelect.value;
            if (!selectedWorkflowKey) return;

            const workflow = workflowDb[selectedWorkflowKey];
            const params = {};
            let allParamsFilled = true;

            workflow.params.forEach(param => {
                const inputElement = document.getElementById(`param-${param.name}`);
                if (inputElement) {
                     if (param.type === 'checkbox') {
                        params[param.name] = inputElement.checked;
                    } else {
                        params[param.name] = inputElement.value;
                        const isVisible = inputElement.parentElement.style.display !== 'none';
                        if (!inputElement.value && isVisible) {
                            allParamsFilled = false;
                        }
                    }
                }
            });

            if (!allParamsFilled) {
                 outputCommand.textContent = "Please fill in all required parameters.";
                 copyBtn.style.display = 'none';
                 return;
            }

            const script = workflow.generate(params);
            outputCommand.textContent = script;
            copyBtn.style.display = 'block';
            copyBtn.textContent = 'Copy';
            copyBtn.classList.remove('copied');
        });
        
        copyBtn.addEventListener('click', () => {
            const textToCopy = outputCommand.textContent;
            navigator.clipboard.writeText(textToCopy).then(() => {
                copyBtn.textContent = 'Copied!';
                copyBtn.classList.add('copied');
            }, (err) => {
                console.error('Failed to copy text: ', err);
            });
        });

        clearBtn.addEventListener('click', () => {
            workflowSelect.value = '';
            paramsForm.innerHTML = '';
            warningsContainer.innerHTML = '';
            outputCommand.textContent = '';
            generateBtn.disabled = true;
            copyBtn.style.display = 'none';
        });

    </script>
</body>
</html>
